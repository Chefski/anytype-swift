default_platform(:ios)

platform :ios do

  lane :upload_dev_symbols do |options|
    upload_symbols(
      release: false,
      min_version: options[:min_version]
    )
  end

  lane :upload_release_symbols do |options|
    upload_symbols(
      release: true,
      min_version: options[:min_version]
    )
  end

  # Private lanes
  
  private_lane :upload_symbols do |options|
    app_store_connect_api_key(
        key_id: ENV['APP_STORE_CONNECT_KEY_ID'],
        issuer_id: ENV['APP_STORE_CONNECT_ISSUER_ID'],
        key_content: ENV['APP_STORE_CONNECT_KEY_CONTENT'],
        duration: 1200,
        in_house: false
    )

    download_dsyms(
       min_version: options[:min_version]
    )

    release_plist = './Anytype/Resources/Plists/GoogleService-Info.plist'
    dev_plist = './Anytype/Resources/Plists/GoogleService-Info-Dev.plist'
    gsp_path = options[:release] ? release_plist : dev_plist

    upload_symbols_to_crashlytics(
      gsp_path: gsp_path,
      binary_path: './Scripts/upload-symbols',
      debug: true
    )      
  end

end
